<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAC ì•± - ì§„ë‹¨ ë„êµ¬</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2196F3;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subtitle {
            color: #757575;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .info-grid {
            display: grid;
            gap: 10px;
        }
        
        .info-row {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .info-label {
            font-weight: 600;
            color: #555;
            min-width: 200px;
        }
        
        .info-value {
            color: #333;
            font-family: monospace;
            word-break: break-all;
        }
        
        .status-ok {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .status-error {
            color: #f44336;
            font-weight: bold;
        }
        
        .status-warning {
            color: #FF9800;
            font-weight: bold;
        }
        
        .json-display {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #1976D2;
        }
        
        button.secondary {
            background: #757575;
        }
        
        button.secondary:hover {
            background: #616161;
        }
        
        button.danger {
            background: #f44336;
        }
        
        button.danger:hover {
            background: #d32f2f;
        }
        
        .test-result {
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            border: 2px solid;
        }
        
        .test-result.success {
            background: #e8f5e9;
            border-color: #4CAF50;
            color: #2e7d32;
        }
        
        .test-result.error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        
        .test-result h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <i class="material-icons">bug_report</i>
            AAC ì•± ì§„ë‹¨ ë„êµ¬
        </h1>
        <p class="subtitle">ì•±ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì§„ë‹¨í•˜ê³  ë¬¸ì œë¥¼ íŒŒì•…í•©ë‹ˆë‹¤</p>
        
        <!-- ê¸°ë³¸ ì •ë³´ -->
        <div class="section">
            <h2>ğŸ“Š ê¸°ë³¸ ì •ë³´</h2>
            <div class="info-grid">
                <div class="info-row">
                    <span class="info-label">AACStorage ë¡œë“œ ìƒíƒœ:</span>
                    <span class="info-value" id="storage-status"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">localStorage ì‚¬ìš© ê°€ëŠ¥:</span>
                    <span class="info-value" id="localstorage-status"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">ì €ì¥ëœ ì¹´ë“œ ê°œìˆ˜:</span>
                    <span class="info-value" id="cards-count"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">ì €ì¥ëœ ì¹´í…Œê³ ë¦¬ ê°œìˆ˜:</span>
                    <span class="info-value" id="categories-count"></span>
                </div>
                <div class="info-row">
                    <span class="info-label">ì¦ê²¨ì°¾ê¸° ì¹´ë“œ ê°œìˆ˜:</span>
                    <span class="info-value" id="favorites-count"></span>
                </div>
            </div>
        </div>
        
        <!-- ì¹´í…Œê³ ë¦¬ ìƒì„¸ -->
        <div class="section">
            <h2>ğŸ“‚ ì¹´í…Œê³ ë¦¬ ìƒì„¸ ì •ë³´</h2>
            <div class="json-display" id="categories-json"></div>
        </div>
        
        <!-- ì¹´ë“œ ìƒì„¸ -->
        <div class="section">
            <h2>ğŸ´ ì¹´ë“œ ìƒì„¸ ì •ë³´</h2>
            <div class="json-display" id="cards-json"></div>
        </div>
        
        <!-- ì¹´í…Œê³ ë¦¬ë³„ ì¹´ë“œ ë¶„ë¥˜ -->
        <div class="section">
            <h2>ğŸ“‘ ì¹´í…Œê³ ë¦¬ë³„ ì¹´ë“œ ë¶„ë¥˜</h2>
            <div id="cards-by-category"></div>
        </div>
        
        <!-- í•„í„°ë§ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h2>ğŸ” ìŒì‹ ì¹´í…Œê³ ë¦¬ í•„í„°ë§ í…ŒìŠ¤íŠ¸</h2>
            <div id="filter-test"></div>
        </div>
        
        <!-- ì‘ì—… ë²„íŠ¼ -->
        <div class="button-group">
            <button onclick="runDiagnostics()">
                <i class="material-icons">refresh</i>
                ì§„ë‹¨ ìƒˆë¡œê³ ì¹¨
            </button>
            <button class="secondary" onclick="window.location.href='index.html'">
                <i class="material-icons">arrow_back</i>
                ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
            <button class="danger" onclick="clearAllData()">
                <i class="material-icons">delete_forever</i>
                ëª¨ë“  ë°ì´í„° ì‚­ì œ
            </button>
        </div>
    </div>
    
    <script src="js/storage.js?v=7"></script>
    <script>
        function runDiagnostics() {
            console.clear();
            console.log('ğŸ” ì§„ë‹¨ ì‹œì‘...');
            
            // AACStorage í™•ì¸
            const storageStatus = document.getElementById('storage-status');
            if (typeof AACStorage === 'undefined') {
                storageStatus.innerHTML = '<span class="status-error">âŒ ë¡œë“œ ì•ˆë¨</span>';
                console.error('âŒ AACStorage not loaded!');
                return;
            } else {
                storageStatus.innerHTML = '<span class="status-ok">âœ… ì •ìƒ ë¡œë“œë¨</span>';
                console.log('âœ… AACStorage loaded');
            }
            
            // localStorage í™•ì¸
            const localStorageStatus = document.getElementById('localstorage-status');
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                localStorageStatus.innerHTML = '<span class="status-ok">âœ… ì‚¬ìš© ê°€ëŠ¥</span>';
                console.log('âœ… localStorage available');
            } catch (e) {
                localStorageStatus.innerHTML = '<span class="status-error">âŒ ì‚¬ìš© ë¶ˆê°€</span>';
                console.error('âŒ localStorage not available:', e);
                return;
            }
            
            // ë°ì´í„° ë¡œë“œ
            const cards = AACStorage.getCards();
            const categories = AACStorage.getCategories();
            const favorites = AACStorage.getFavoriteCards();
            
            console.log('ğŸ“Š ë¡œë“œëœ ë°ì´í„°:', {
                cards: cards.length,
                categories: categories.length,
                favorites: favorites.length
            });
            
            // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
            document.getElementById('cards-count').innerHTML = `<span class="status-ok">${cards.length}ê°œ</span>`;
            document.getElementById('categories-count').innerHTML = `<span class="status-ok">${categories.length}ê°œ</span>`;
            document.getElementById('favorites-count').innerHTML = `<span class="status-ok">${favorites.length}ê°œ</span>`;
            
            // ì¹´í…Œê³ ë¦¬ JSON í‘œì‹œ
            document.getElementById('categories-json').textContent = JSON.stringify(categories, null, 2);
            
            // ì¹´ë“œ JSON í‘œì‹œ
            document.getElementById('cards-json').textContent = JSON.stringify(cards, null, 2);
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì¹´ë“œ ë¶„ë¥˜
            const cardsByCategoryDiv = document.getElementById('cards-by-category');
            let categoryHtml = '';
            
            categories.forEach(cat => {
                const categoryCards = cards.filter(card => card.category === cat.name);
                console.log(`ğŸ“‚ ì¹´í…Œê³ ë¦¬ "${cat.name}" (ID: ${cat.id}):`, categoryCards.length, 'ê°œ ì¹´ë“œ');
                console.log('   ì¹´ë“œ ëª©ë¡:', categoryCards.map(c => `"${c.text}"`).join(', '));
                
                const statusClass = categoryCards.length > 0 ? 'status-ok' : 'status-warning';
                categoryHtml += `
                    <div class="info-row">
                        <span class="info-label">${cat.name} (ID: ${cat.id}):</span>
                        <span class="info-value ${statusClass}">${categoryCards.length}ê°œ ì¹´ë“œ</span>
                    </div>
                `;
            });
            
            // ì¹´í…Œê³ ë¦¬ ì—†ëŠ” ì¹´ë“œ
            const uncategorized = cards.filter(card => !categories.some(cat => cat.name === card.category));
            if (uncategorized.length > 0) {
                console.log('âš ï¸ ì¹´í…Œê³ ë¦¬ ì—†ëŠ” ì¹´ë“œ:', uncategorized);
                categoryHtml += `
                    <div class="info-row">
                        <span class="info-label">ì¹´í…Œê³ ë¦¬ ì—†ìŒ:</span>
                        <span class="info-value status-warning">${uncategorized.length}ê°œ ì¹´ë“œ</span>
                    </div>
                `;
            }
            
            cardsByCategoryDiv.innerHTML = categoryHtml;
            
            // ìŒì‹ ì¹´í…Œê³ ë¦¬ í•„í„°ë§ í…ŒìŠ¤íŠ¸
            const filterTestDiv = document.getElementById('filter-test');
            const foodCategory = categories.find(c => c.name === 'ìŒì‹');
            
            if (!foodCategory) {
                filterTestDiv.innerHTML = `
                    <div class="test-result error">
                        <h3><i class="material-icons">error</i> í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</h3>
                        <p>âŒ "ìŒì‹" ì¹´í…Œê³ ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</p>
                    </div>
                `;
                console.error('âŒ "ìŒì‹" ì¹´í…Œê³ ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            console.log('ğŸ” ìŒì‹ ì¹´í…Œê³ ë¦¬ ì°¾ìŒ:', foodCategory);
            
            // í•„í„°ë§ ë¡œì§ (app.jsì˜ renderCardsì™€ ë™ì¼)
            const filteredCards = cards.filter(card => card.category === foodCategory.name);
            
            console.log('ğŸ´ í•„í„°ë§ ê²°ê³¼:', filteredCards);
            console.log('   - í•„í„°ë§ëœ ì¹´ë“œ ê°œìˆ˜:', filteredCards.length);
            console.log('   - í•„í„°ë§ëœ ì¹´ë“œ:', filteredCards.map(c => `"${c.text}" (category: "${c.category}")`));
            
            if (filteredCards.length === 0) {
                // ë””ë²„ê¹…: ëª¨ë“  ì¹´ë“œì˜ category ê°’ í™•ì¸
                console.log('ğŸ” ì „ì²´ ì¹´ë“œì˜ category ê°’:');
                cards.forEach(card => {
                    console.log(`   - "${card.text}": category="${card.category}" (íƒ€ì…: ${typeof card.category})`);
                });
                
                filterTestDiv.innerHTML = `
                    <div class="test-result error">
                        <h3><i class="material-icons">error</i> í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</h3>
                        <p>âŒ "ìŒì‹" ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤!</p>
                        <p><strong>ì¹´í…Œê³ ë¦¬ ì´ë¦„:</strong> "${foodCategory.name}"</p>
                        <p><strong>ì „ì²´ ì¹´ë“œ ê°œìˆ˜:</strong> ${cards.length}ê°œ</p>
                        <p><strong>í•„í„°ë§ ê²°ê³¼:</strong> ${filteredCards.length}ê°œ</p>
                        <p><strong>ë¬¸ì œ:</strong> ì¹´ë“œì˜ category ì†ì„±ì´ "${foodCategory.name}"ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                console.error('âŒ ìŒì‹ ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ì‹¤íŒ¨!');
            } else {
                filterTestDiv.innerHTML = `
                    <div class="test-result success">
                        <h3><i class="material-icons">check_circle</i> í…ŒìŠ¤íŠ¸ ì„±ê³µ</h3>
                        <p>âœ… "ìŒì‹" ì¹´í…Œê³ ë¦¬ì—ì„œ ${filteredCards.length}ê°œì˜ ì¹´ë“œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤:</p>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            ${filteredCards.map(card => `<li>"${card.text}" (ë°°ê²½ìƒ‰: ${card.backgroundColor})</li>`).join('')}
                        </ul>
                        <p style="margin-top: 10px;"><strong>ê²°ë¡ :</strong> í•„í„°ë§ ë¡œì§ì€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.</p>
                    </div>
                `;
                console.log('âœ… ìŒì‹ ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ì„±ê³µ!');
            }
            
            console.log('âœ… ì§„ë‹¨ ì™„ë£Œ');
        }
        
        function clearAllData() {
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            const keysToRemove = [
                'aac_cards',
                'aac_categories',
                'aac_favorite_cards',
                'aac_favorite_sentences',
                'aac_auxiliary_words',
                'aac_settings'
            ];
            
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
                console.log('ğŸ—‘ï¸ ì‚­ì œë¨:', key);
            });
            
            alert('âœ… ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
            location.reload();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì§„ë‹¨ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', runDiagnostics);
    </script>
</body>
</html>
