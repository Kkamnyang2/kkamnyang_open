<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAC ì•± ì²´í¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 { 
            color: white; 
            margin-bottom: 30px;
            text-align: center;
            font-size: 32px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .card {
            background: white;
            padding: 25px;
            margin: 15px 0;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .card h2 {
            margin-bottom: 15px;
            font-size: 20px;
            color: #667eea;
        }
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
        }
        .status.pass { background: #4CAF50; color: white; }
        .status.fail { background: #f44336; color: white; }
        .status.pending { background: #ff9800; color: white; }
        .info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: white;
        }
        .spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” AAC ì•± ì‹œìŠ¤í…œ ì²´í¬</h1>
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ì‹œìŠ¤í…œ ì ê²€ ì¤‘...</p>
        </div>
        <div id="results" style="display: none;"></div>
    </div>

    <!-- ì•± ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="js/storage.js?v=3"></script>
    <script src="js/tts.js?v=3"></script>
    <script src="js/app.js?v=3"></script>

    <script>
    (function() {
        'use strict';
        
        // ê²°ê³¼ ì»¨í…Œì´ë„ˆ
        let resultsDiv;
        let loadingDiv;
        
        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥
        const testResults = {
            storage: { status: 'pending', message: '' },
            tts: { status: 'pending', message: '' },
            app: { status: 'pending', message: '' }
        };
        
        // ê²°ê³¼ ì¹´ë“œ ìƒì„±
        function createCard(title, status, info) {
            return `
                <div class="card">
                    <h2>${title}</h2>
                    <span class="status ${status}">${
                        status === 'pass' ? 'âœ… í†µê³¼' : 
                        status === 'fail' ? 'âŒ ì‹¤íŒ¨' : 
                        'â³ ëŒ€ê¸° ì¤‘'
                    }</span>
                    ${info ? `<div class="info">${info}</div>` : ''}
                </div>
            `;
        }
        
        // ê²°ê³¼ ë Œë”ë§
        function renderResults() {
            if (!resultsDiv) return;
            
            let html = '';
            
            // Storage í…ŒìŠ¤íŠ¸
            html += createCard(
                'ğŸ“¦ Storage ëª¨ë“ˆ',
                testResults.storage.status,
                testResults.storage.message
            );
            
            // TTS í…ŒìŠ¤íŠ¸
            html += createCard(
                'ğŸ”Š TTS ëª¨ë“ˆ',
                testResults.tts.status,
                testResults.tts.message
            );
            
            // App í…ŒìŠ¤íŠ¸
            html += createCard(
                'ğŸš€ App ì´ˆê¸°í™”',
                testResults.app.status,
                testResults.app.message
            );
            
            // ì•¡ì…˜ ë²„íŠ¼
            const allPass = Object.values(testResults).every(r => r.status === 'pass');
            html += `
                <div class="card" style="text-align: center;">
                    <h2>ë‹¤ìŒ ë‹¨ê³„</h2>
                    ${allPass ? 
                        '<p style="margin-bottom: 15px;">âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! ë©”ì¸ ì•±ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>' :
                        '<p style="margin-bottom: 15px;">âš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>'
                    }
                    <button onclick="location.href='index.html'">ë©”ì¸ ì•± ì—´ê¸°</button>
                    <button onclick="location.href='debug.html'">ë””ë²„ê·¸ í˜ì´ì§€</button>
                    <button onclick="location.reload()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
        
        // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        function runTests() {
            console.log('=== AAC ì•± ì‹œìŠ¤í…œ ì²´í¬ ì‹œì‘ ===');
            
            // 1. Storage í…ŒìŠ¤íŠ¸
            console.log('1. Storage ëª¨ë“ˆ ì²´í¬...');
            if (typeof window.AACStorage === 'undefined') {
                testResults.storage.status = 'fail';
                testResults.storage.message = 
                    `window.AACStorageê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\n` +
                    `ê°€ëŠ¥í•œ ì›ì¸:\n` +
                    `â€¢ storage.js íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨\n` +
                    `â€¢ JavaScript ë¬¸ë²• ì˜¤ë¥˜\n` +
                    `â€¢ ë¸Œë¼ìš°ì € ìºì‹œ ë¬¸ì œ\n\n` +
                    `í•´ê²° ë°©ë²•:\n` +
                    `1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12) ì—´ê¸°\n` +
                    `2. Network íƒ­ì—ì„œ storage.js ë¡œë“œ í™•ì¸\n` +
                    `3. Console íƒ­ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸`;
            } else {
                try {
                    const cards = window.AACStorage.getCards();
                    const categories = window.AACStorage.getCategories();
                    testResults.storage.status = 'pass';
                    testResults.storage.message = 
                        `âœ… AACStorage ì •ìƒ ë¡œë“œ\n\n` +
                        `íƒ€ì…: ${typeof window.AACStorage}\n` +
                        `ë©”ì„œë“œ: ${Object.keys(window.AACStorage).length}ê°œ\n` +
                        `ì¹´ë“œ: ${cards.length}ê°œ\n` +
                        `ì¹´í…Œê³ ë¦¬: ${categories.length}ê°œ`;
                } catch (error) {
                    testResults.storage.status = 'fail';
                    testResults.storage.message = 
                        `AACStorageëŠ” ì¡´ì¬í•˜ì§€ë§Œ ë©”ì„œë“œ í˜¸ì¶œ ì‹¤íŒ¨\n\n` +
                        `ì—ëŸ¬: ${error.message}\n\n` +
                        `ìŠ¤íƒ: ${error.stack}`;
                }
            }
            
            // 2. TTS í…ŒìŠ¤íŠ¸
            console.log('2. TTS ëª¨ë“ˆ ì²´í¬...');
            if (typeof window.TTS === 'undefined') {
                testResults.tts.status = 'fail';
                testResults.tts.message = 
                    `window.TTSê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\n` +
                    `ê°€ëŠ¥í•œ ì›ì¸:\n` +
                    `â€¢ tts.js íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨\n` +
                    `â€¢ Storage ì˜ì¡´ì„± ë¬¸ì œ\n` +
                    `â€¢ JavaScript ë¬¸ë²• ì˜¤ë¥˜`;
            } else {
                try {
                    const hasInit = typeof window.TTS.init === 'function';
                    const hasSpeak = typeof window.TTS.speak === 'function';
                    testResults.tts.status = hasInit && hasSpeak ? 'pass' : 'fail';
                    testResults.tts.message = 
                        `âœ… TTS ì •ìƒ ë¡œë“œ\n\n` +
                        `íƒ€ì…: ${typeof window.TTS}\n` +
                        `init ë©”ì„œë“œ: ${hasInit ? 'ì¡´ì¬' : 'ì—†ìŒ'}\n` +
                        `speak ë©”ì„œë“œ: ${hasSpeak ? 'ì¡´ì¬' : 'ì—†ìŒ'}\n` +
                        `useResponsiveVoice: ${window.TTS.useResponsiveVoice}`;
                } catch (error) {
                    testResults.tts.status = 'fail';
                    testResults.tts.message = `TTS ì ‘ê·¼ ì¤‘ ì—ëŸ¬: ${error.message}`;
                }
            }
            
            // 3. App í…ŒìŠ¤íŠ¸
            console.log('3. App ì´ˆê¸°í™” ì²´í¬...');
            if (typeof currentCards === 'undefined') {
                testResults.app.status = 'fail';
                testResults.app.message = 
                    `currentCards ë³€ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\n` +
                    `ê°€ëŠ¥í•œ ì›ì¸:\n` +
                    `â€¢ app.js íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨\n` +
                    `â€¢ ì˜ì¡´ì„±(Storage, TTS) ë¡œë“œ ì‹¤íŒ¨\n` +
                    `â€¢ JavaScript ì‹¤í–‰ ì˜¤ë¥˜`;
            } else {
                try {
                    testResults.app.status = 'pass';
                    testResults.app.message = 
                        `âœ… App ì •ìƒ ë¡œë“œ\n\n` +
                        `currentCards: ${currentCards.length}ê°œ\n` +
                        `currentCategories: ${typeof currentCategories !== 'undefined' ? currentCategories.length + 'ê°œ' : 'undefined'}\n` +
                        `selectedCategory: ${typeof selectedCategory !== 'undefined' ? selectedCategory : 'undefined'}`;
                } catch (error) {
                    testResults.app.status = 'fail';
                    testResults.app.message = `App ë³€ìˆ˜ ì ‘ê·¼ ì¤‘ ì—ëŸ¬: ${error.message}`;
                }
            }
            
            console.log('=== ì‹œìŠ¤í…œ ì²´í¬ ì™„ë£Œ ===');
            console.log('Results:', testResults);
            
            // UI ì—…ë°ì´íŠ¸
            if (loadingDiv) loadingDiv.style.display = 'none';
            if (resultsDiv) {
                resultsDiv.style.display = 'block';
                renderResults();
            }
        }
        
        // DOM ë¡œë“œ í›„ ì‹¤í–‰
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        function init() {
            resultsDiv = document.getElementById('results');
            loadingDiv = document.getElementById('loading');
            
            // 1ì´ˆ í›„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ëŒ€ê¸°)
            setTimeout(runTests, 1000);
        }
        
        // ì „ì—­ ì—ëŸ¬ ìº¡ì²˜
        window.onerror = function(msg, url, line, col, error) {
            console.error('ì „ì—­ ì—ëŸ¬:', msg, url, line);
            if (resultsDiv) {
                resultsDiv.style.display = 'block';
                if (loadingDiv) loadingDiv.style.display = 'none';
                resultsDiv.innerHTML = createCard(
                    'âŒ ì „ì—­ ì—ëŸ¬ ë°œìƒ',
                    'fail',
                    `ë©”ì‹œì§€: ${msg}\níŒŒì¼: ${url}\nìœ„ì¹˜: ${line}:${col}\n${error ? error.stack : ''}`
                );
            }
            return false;
        };
    })();
    </script>
</body>
</html>
