<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5; 
        }
        .test-result {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .pass { border-left: 4px solid #4CAF50; }
        .fail { border-left: 4px solid #f44336; }
        pre {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        h1 { color: #333; }
        h3 { margin: 0 0 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ” JavaScript íŒŒì¼ ë¡œë“œ í…ŒìŠ¤íŠ¸</h1>
    <div id="results">
        <p>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</p>
    </div>

    <!-- ResponsiveVoice API (ì„ íƒì‚¬í•­) -->
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=JQZ0h1bp"></script>
    
    <!-- ì‹¤ì œ ì•± ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="js/storage.js?v=2"></script>
    <script src="js/tts.js?v=2"></script>
    <script src="js/app.js?v=2"></script>

    <script>
        // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            console.log('=== í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            const results = document.getElementById('results');
            
            function addResult(title, passed, details) {
                const div = document.createElement('div');
                div.className = `test-result ${passed ? 'pass' : 'fail'}`;
                div.innerHTML = `
                    <h3>${passed ? 'âœ…' : 'âŒ'} ${title}</h3>
                    <pre>${details}</pre>
                `;
                results.appendChild(div);
            }

            // ì´ˆê¸° ë©”ì‹œì§€ ì œê±°
            results.innerHTML = '';
            
            // ì•½ê°„ì˜ ì§€ì—°ì„ ì£¼ì–´ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë  ì‹œê°„ í™•ë³´
            setTimeout(() => {
                // 1. storage.js í…ŒìŠ¤íŠ¸
                console.log('1. Testing storage.js...');
                if (typeof window.AACStorage !== 'undefined') {
                    try {
                        const methodCount = Object.keys(window.AACStorage).length;
                        addResult('storage.js ë¡œë“œ', true, 
                            `âœ… AACStorage ê°ì²´ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\n` +
                            `íƒ€ì…: ${typeof window.AACStorage}\n` +
                            `ë©”ì„œë“œ ê°œìˆ˜: ${methodCount}\n` +
                            `ë©”ì„œë“œ ëª©ë¡: ${Object.keys(window.AACStorage).join(', ')}`
                        );
                        
                        // getCards í…ŒìŠ¤íŠ¸
                        try {
                            const cards = window.AACStorage.getCards();
                            addResult('AACStorage.getCards() í˜¸ì¶œ', true,
                                `âœ… ì¹´ë“œ ë¡œë“œ ì„±ê³µ\n` +
                                `ì¹´ë“œ ê°œìˆ˜: ${cards.length}\n` +
                                `ì²« ë²ˆì§¸ ì¹´ë“œ: ${cards[0] ? cards[0].text : 'N/A'}`
                            );
                        } catch (error) {
                            addResult('AACStorage.getCards() í˜¸ì¶œ', false,
                                `âŒ ì—ëŸ¬: ${error.message}\n${error.stack}`
                            );
                        }
                    } catch (error) {
                        addResult('storage.js ë¡œë“œ', false,
                            `âŒ AACStorage ì ‘ê·¼ ì¤‘ ì—ëŸ¬: ${error.message}`
                        );
                    }
                } else {
                    const storageKeys = Object.keys(window).filter(k => k.toLowerCase().includes('storage'));
                    addResult('storage.js ë¡œë“œ', false,
                        `âŒ window.AACStorageê°€ undefinedì…ë‹ˆë‹¤.\n\n` +
                        `window ê°ì²´ì—ì„œ 'storage' ê´€ë ¨ í‚¤:\n${storageKeys.join(', ') || 'ì—†ìŒ'}\n\n` +
                        `ê°€ëŠ¥í•œ ì›ì¸:\n` +
                        `1. storage.js íŒŒì¼ì´ ë¡œë“œë˜ì§€ ì•ŠìŒ\n` +
                        `2. JavaScript ë¬¸ë²• ì˜¤ë¥˜\n` +
                        `3. ë¸Œë¼ìš°ì € ìºì‹œ ë¬¸ì œ`
                    );
                }

                // 2. tts.js í…ŒìŠ¤íŠ¸
                console.log('2. Testing tts.js...');
                if (typeof window.TTS !== 'undefined') {
                    try {
                        const methodCount = Object.keys(window.TTS).length;
                        addResult('tts.js ë¡œë“œ', true,
                            `âœ… TTS ê°ì²´ê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\n` +
                            `íƒ€ì…: ${typeof window.TTS}\n` +
                            `ì†ì„±/ë©”ì„œë“œ ê°œìˆ˜: ${methodCount}\n` +
                            `ì£¼ìš” ë©”ì„œë“œ: ${Object.keys(window.TTS).filter(k => typeof window.TTS[k] === 'function').slice(0, 5).join(', ')}`
                        );
                    } catch (error) {
                        addResult('tts.js ë¡œë“œ', false,
                            `âŒ TTS ì ‘ê·¼ ì¤‘ ì—ëŸ¬: ${error.message}`
                        );
                    }
                } else {
                    addResult('tts.js ë¡œë“œ', false,
                        `âŒ window.TTSê°€ undefinedì…ë‹ˆë‹¤.\n\n` +
                        `ê°€ëŠ¥í•œ ì›ì¸:\n` +
                        `1. tts.js íŒŒì¼ì´ ë¡œë“œë˜ì§€ ì•ŠìŒ\n` +
                        `2. storage.js ì˜ì¡´ì„± ë¬¸ì œë¡œ ì‹¤í–‰ ì‹¤íŒ¨\n` +
                        `3. JavaScript ë¬¸ë²• ì˜¤ë¥˜`
                    );
                }

                // 3. app.js ë³€ìˆ˜ í…ŒìŠ¤íŠ¸
                console.log('3. Testing app.js...');
                if (typeof currentCards !== 'undefined') {
                    addResult('app.js ë¡œë“œ', true,
                        `âœ… app.jsê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\n` +
                        `currentCards íƒ€ì…: ${typeof currentCards}\n` +
                        `ì¹´ë“œ ê°œìˆ˜: ${currentCards.length}\n` +
                        `currentCategories ê°œìˆ˜: ${typeof currentCategories !== 'undefined' ? currentCategories.length : 'N/A'}`
                    );
                } else {
                    addResult('app.js ë¡œë“œ', false,
                        `âŒ currentCards ë³€ìˆ˜ê°€ undefinedì…ë‹ˆë‹¤.\n\n` +
                        `ê°€ëŠ¥í•œ ì›ì¸:\n` +
                        `1. app.js íŒŒì¼ì´ ë¡œë“œë˜ì§€ ì•ŠìŒ\n` +
                        `2. ì˜ì¡´ì„±(AACStorage, TTS) ë¡œë“œ ì‹¤íŒ¨ë¡œ app.js ì‹¤í–‰ ì¤‘ë‹¨\n` +
                        `3. JavaScript ë¬¸ë²• ì˜¤ë¥˜`
                    );
                }

                // 4. ì „ì²´ ìš”ì•½
                console.log('=== í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
                console.log('window.AACStorage:', typeof window.AACStorage);
                console.log('window.TTS:', typeof window.TTS);
                console.log('currentCards:', typeof currentCards);
                
                const summary = document.createElement('div');
                summary.className = 'test-result';
                summary.style.background = '#e3f2fd';
                summary.innerHTML = `
                    <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ìš”ì•½</h3>
                    <pre>AACStorage: ${typeof window.AACStorage}
TTS: ${typeof window.TTS}
currentCards: ${typeof currentCards}
currentCategories: ${typeof currentCategories}

ë¸Œë¼ìš°ì €: ${navigator.userAgent}
ì‹œê°„: ${new Date().toLocaleString()}</pre>
                `;
                results.appendChild(summary);
                
            }, 500); // 500ms ì§€ì—°
        });

        // ì „ì—­ ì—ëŸ¬ ìº¡ì²˜
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('ì „ì—­ ì—ëŸ¬:', message, source, lineno);
            const results = document.getElementById('results');
            if (results) {
                const div = document.createElement('div');
                div.className = 'test-result fail';
                div.innerHTML = `
                    <h3>âŒ ì „ì—­ ì—ëŸ¬ ë°œìƒ</h3>
                    <pre>ë©”ì‹œì§€: ${message}
íŒŒì¼: ${source}
ë¼ì¸: ${lineno}:${colno}
${error ? 'Stack: ' + error.stack : ''}</pre>
                `;
                results.appendChild(div);
            }
            return false;
        };
    </script>
</body>
</html>
